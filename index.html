<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Hello, World! • A-Frame three.ar.js</title>
    <meta name="description" content="Hello, World! • A-Frame three.ar.js">
    <script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
    <script src="https://rawgit.com/google-ar/three.ar.js/master/dist/three.ar.js"></script>
    <script src="./aframe-three-ar.js"></script>
    <script src="https://3d.io/releases/3dio-js/1.0.x-beta/3dio.min.js"></script>
</head>

<body onclick="startVideo()">
    <a-scene three-ar vr-mode-ui="enabled:false" id="scene">
        <a-asset>
            <video autoplay id="ground"></video>
        </a-asset>
        <!-- <a-sphere id="sphere" scale="0.25 0.25 0.25" position="0 0.3125 -1.25" radius="1.25" color="#EF2D5E" shadow>
        </a-sphere> -->
        <a-plane id="plane" position="0 0 -1" rotation="-90 0 0" width="4" height="4" color="#7BC8A4" shadow></a-plane>
    </a-scene>
    <script>
        let alternatives;
        let counter = 0;
        // var 
        if (navigator.permissions) {
            // https://w3c.github.io/orientation-sensor/#model
            Promise.all([navigator.permissions.query({ name: "accelerometer" }),
            navigator.permissions.query({ name: "magnetometer" }),
            navigator.permissions.query({ name: "gyroscope" })])
                .then(results => {
                    if (results.every(result => result.state === "granted")) {
                    } else {
                        console.log("Permission to use sensor was denied.");
                    }
                }).catch(err => {
                    console.log("Integration with Permissions API is not enabled, still try to start app.");
                });
        } else {
            console.log("No Permissions API, still try to start app.");
            }
        var acc = new Accelerometer();
        function update(stream) {
            document.querySelector('video').src = stream.url;
            console.log(acc);
        }

        const constraints = {
            video: true
        };

        const video = document.querySelector('video');
        const hdConstraints = {
            video: { width: { min: 1280 }, height: { min: 720 } }
        };

        navigator.mediaDevices.getUserMedia(hdConstraints).
            then((stream) => {
                video.srcObject = stream
            });

        function startVideo() {
            var sphere = document.getElementById('plane');
            sphere.setAttribute('src', '#ground');

            let cylinder = document.createElement("a-cylinder");
            cylinder.setAttribute("scale", 0.25 + " " + 0.25 + " " + 0.25);
            cylinder.setAttribute("position", "0 0.3125 -1.25");
            cylinder.setAttribute("radius", "1.25");
            cylinder.setAttribute("color", "#EF2D5E");

            document.getElementsByTagName("a-scene")[0].appendChild(cylinder)

        }


    </script>
</body>

</html>